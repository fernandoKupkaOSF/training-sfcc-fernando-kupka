{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/cart.js","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/cart/cart.js","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/product/base.js","webpack:///./cartridges/app_storefront_training/cartridge/client/default/js/util.js"],"names":["processInclude","require","$","document","ready","base","appendToUrl","url","params","newUrl","indexOf","Object","keys","map","key","encodeURIComponent","join","validateBasket","data","valid","error","message","errorHtml","append","empty","resources","emptyCartMsg","numberOfItems","numItems","removeClass","addClass","updateCartTotals","totals","totalShippingCost","totalTax","grandTotal","subTotal","orderLevelDiscountTotal","value","formatted","shippingLevelDiscountTotal","items","forEach","item","UUID","renderedPromotions","priceTotal","renderedPrice","createErrorNotification","updateApproachingDiscounts","approachingDiscounts","html","length","discountMsg","updateAvailability","uuid","lineItem","messages","i","availability","inStockDate","updateProductDetails","cartModel","find","variationAttributes","colorAttr","attr","attributeId","colorSelector","newColor","displayValue","text","sizeAttr","sizeSelector","newSize","imageSelector","images","small","alt","title","qtySelector","val","quantity","newProductId","priceSelector","price","sales","decimalPrice","list","listPriceSelector","getModalHtmlElement","remove","htmlString","parseHtml","$html","parseHTML","body","footer","children","fillModalElement","editProductUrl","spinner","start","ajax","method","dataType","success","parsedHtml","modal","stop","confirmDelete","actionUrl","productID","productName","$deleteConfirmBtn","$productToRemoveSpan","module","exports","on","e","preventDefault","click","toggle","urlParams","pid","type","basket","toBeDeletedUUIDs","hasBonusProduct","discountsHtml","trigger","err","responseJSON","redirectUrl","window","location","href","errorMessage","preSelectQty","parents","context","hasClass","reload","parseInt","change","methodID","submit","hide","show","$form","serialize","couponCode","code","methods","editBonusProducts","response","dialog","$productContainer","closest","product","readyToOrder","available","allAvailable","toArray","every","allReady","info_selectforstock","container","id","selectedQuantity","updateProductUrl","form","getPidValue","uuidToBeDeleted","selectAttribute","colorAttribute","removeBonusProduct","selectBonusProduct","enableBonusProductSelection","showMoreBonusProducts","addBonusProductsToCart","$el","getQuantitySelector","getQuantitySelected","processSwatchValues","values","attrValue","$attrValue","$swatchAnchor","parent","selected","removeAttr","selectable","processNonSwatchValues","$attr","$defaultOption","resetUrl","updateAttrs","attrs","attrsWithSwatches","availabilityValue","availabilityMessages","getPromotionsHtml","promotions","promotion","details","calloutMsg","getAttributesHtml","attributes","attributeGroup","ID","attribute","label","updateOptions","options","option","$optionEl","valueEl","handleVariantResponse","isChoiceOfBonusProducts","isVaraint","productType","primaryImageUrls","large","imageUrl","idx","eq","$priceSelector","replaceWith","$selectButton","updateQuantities","quantities","optionsHtml","attributeSelect","selectedValueUrl","getAddToCartUrl","chooseBonusProducts","bonusUrl","bonusChoiceRuleBased","showProductsUrlRuleBased","showProductsUrlListBased","maxBonusItems","pliUUID","addToCartUrl","pageSize","labels","selectprods","handlePostCartAdd","messageType","newBonusDiscountLineItem","setTimeout","getChildProducts","childProducts","each","push","JSON","stringify","getOptions","$elOption","urlValue","selectedValueId","optionId","currentTarget","addToCart","pidsObj","setPids","qty","$choiceOfBonusProduct","maxPids","submittedQty","totalQty","optionID","valueId","selectedBonusProductHtml","$selected","count","$readyToOrderBonusProducts","queryString","pidsObject","bonusProducts","qtyOption","productId","msgSuccess","include"],"mappings":"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","file":"default/js/cart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./cartridges/app_storefront_training/cartridge/client/default/js/cart.js\");\n","'use strict';\n\nvar processInclude = require('./util');\n\n$(document).ready(function () {\n    processInclude(require('./cart/cart'));\n});\n","'use strict';\n\nvar base = require('../product/base');\n\n/**\n * appends params to a url\n * @param {string} url - Original url\n * @param {Object} params - Parameters to append\n * @returns {string} result url with appended parameters\n */\nfunction appendToUrl(url, params) {\n    var newUrl = url;\n    newUrl += (newUrl.indexOf('?') !== -1 ? '&' : '?') + Object.keys(params).map(function (key) {\n        return key + '=' + encodeURIComponent(params[key]);\n    }).join('&');\n\n    return newUrl;\n}\n\n/**\n * Checks whether the basket is valid. if invalid displays error message and disables\n * checkout button\n * @param {Object} data - AJAX response from the server\n */\nfunction validateBasket(data) {\n    if (data.valid.error) {\n        if (data.valid.message) {\n            var errorHtml = '<div class=\"alert alert-danger alert-dismissible valid-cart-error ' +\n                'fade show\" role=\"alert\">' +\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n                '<span aria-hidden=\"true\">&times;</span>' +\n                '</button>' + data.valid.message + '</div>';\n\n            $('.cart-error').append(errorHtml);\n        } else {\n            $('.cart').empty().append('<div class=\"row\"> ' +\n                '<div class=\"col-12 text-center\"> ' +\n                '<h1>' + data.resources.emptyCartMsg + '</h1> ' +\n                '</div> ' +\n                '</div>'\n            );\n            $('.number-of-items').empty().append(data.resources.numberOfItems);\n            $('.minicart-quantity').empty().append(data.numItems);\n            $('.minicart .popover').empty();\n            $('.minicart .popover').removeClass('show');\n        }\n\n        $('.checkout-btn').addClass('disabled');\n    } else {\n        $('.checkout-btn').removeClass('disabled');\n    }\n}\n\n/**\n * re-renders the order totals and the number of items in the cart\n * @param {Object} data - AJAX response from the server\n */\nfunction updateCartTotals(data) {\n    $('.number-of-items').empty().append(data.resources.numberOfItems);\n    $('.shipping-cost').empty().append(data.totals.totalShippingCost);\n    $('.tax-total').empty().append(data.totals.totalTax);\n    $('.grand-total').empty().append(data.totals.grandTotal);\n    $('.sub-total').empty().append(data.totals.subTotal);\n    $('.minicart-quantity').empty().append(data.numItems);\n\n    if (data.totals.orderLevelDiscountTotal.value > 0) {\n        $('.order-discount').removeClass('hide-order-discount');\n        $('.order-discount-total').empty()\n            .append('- ' + data.totals.orderLevelDiscountTotal.formatted);\n    } else {\n        $('.order-discount').addClass('hide-order-discount');\n    }\n\n    if (data.totals.shippingLevelDiscountTotal.value > 0) {\n        $('.shipping-discount').removeClass('hide-shipping-discount');\n        $('.shipping-discount-total').empty().append('- ' +\n            data.totals.shippingLevelDiscountTotal.formatted);\n    } else {\n        $('.shipping-discount').addClass('hide-shipping-discount');\n    }\n\n    data.items.forEach(function (item) {\n        $('.item-' + item.UUID).empty().append(item.renderedPromotions);\n        $('.item-total-' + item.UUID).empty().append(item.priceTotal.renderedPrice);\n    });\n}\n\n/**\n * re-renders the order totals and the number of items in the cart\n * @param {Object} message - Error message to display\n */\nfunction createErrorNotification(message) {\n    var errorHtml = '<div class=\"alert alert-danger alert-dismissible valid-cart-error ' +\n        'fade show\" role=\"alert\">' +\n        '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n        '<span aria-hidden=\"true\">&times;</span>' +\n        '</button>' + message + '</div>';\n\n    $('.cart-error').append(errorHtml);\n}\n\n/**\n * re-renders the approaching discount messages\n * @param {Object} approachingDiscounts - updated approaching discounts for the cart\n */\nfunction updateApproachingDiscounts(approachingDiscounts) {\n    var html = '';\n    $('.approaching-discounts').empty();\n    if (approachingDiscounts.length > 0) {\n        approachingDiscounts.forEach(function (item) {\n            html += '<div class=\"single-approaching-discount text-center\">'\n                + item.discountMsg + '</div>';\n        });\n    }\n    $('.approaching-discounts').append(html);\n}\n\n/**\n * Updates the availability of a product line item\n * @param {Object} data - AJAX response from the server\n * @param {string} uuid - The uuid of the product line item to update\n */\nfunction updateAvailability(data, uuid) {\n    var lineItem;\n    var messages = '';\n\n    for (var i = 0; i < data.items.length; i++) {\n        if (data.items[i].UUID === uuid) {\n            lineItem = data.items[i];\n            break;\n        }\n    }\n\n    $('.availability-' + lineItem.UUID).empty();\n\n    if (lineItem.availability) {\n        if (lineItem.availability.messages) {\n            lineItem.availability.messages.forEach(function (message) {\n                messages += '<p class=\"line-item-attributes\">' + message + '</p>';\n            });\n        }\n\n        if (lineItem.availability.inStockDate) {\n            messages += '<p class=\"line-item-attributes line-item-instock-date\">'\n                + lineItem.availability.inStockDate\n                + '</p>';\n        }\n    }\n\n    $('.availability-' + lineItem.UUID).html(messages);\n}\n\n/**\n * Updates details of a product line item\n * @param {Object} data - AJAX response from the server\n * @param {string} uuid - The uuid of the product line item to update\n */\nfunction updateProductDetails(data, uuid) {\n    var lineItem = data.cartModel.items.find(function (item) {\n        return item.UUID === uuid;\n    });\n\n    if (lineItem.variationAttributes) {\n        var colorAttr = lineItem.variationAttributes.find(function (attr) {\n            return attr.attributeId === 'color';\n        });\n\n        if (colorAttr) {\n            var colorSelector = '.Color-' + uuid;\n            var newColor = 'Color: ' + colorAttr.displayValue;\n            $(colorSelector).text(newColor);\n        }\n\n        var sizeAttr = lineItem.variationAttributes.find(function (attr) {\n            return attr.attributeId === 'size';\n        });\n\n        if (sizeAttr) {\n            var sizeSelector = '.Size-' + uuid;\n            var newSize = 'Size: ' + sizeAttr.displayValue;\n            $(sizeSelector).text(newSize);\n        }\n\n        var imageSelector = '.card.product-info.uuid-' + uuid + ' .item-image > img';\n        $(imageSelector).attr('src', lineItem.images.small[0].url);\n        $(imageSelector).attr('alt', lineItem.images.small[0].alt);\n        $(imageSelector).attr('title', lineItem.images.small[0].title);\n    }\n\n    var qtySelector = '.quantity[data-uuid=\"' + uuid + '\"]';\n    $(qtySelector).val(lineItem.quantity);\n    $(qtySelector).data('pid', data.newProductId);\n\n    $('.remove-product[data-uuid=\"' + uuid + '\"]').data('pid', data.newProductId);\n\n    var priceSelector = '.line-item-price-' + uuid + ' .sales .value';\n    $(priceSelector).text(lineItem.price.sales.formatted);\n    $(priceSelector).attr('content', lineItem.price.sales.decimalPrice);\n\n    if (lineItem.price.list) {\n        var listPriceSelector = '.line-item-price-' + uuid + ' .list .value';\n        $(listPriceSelector).text(lineItem.price.list.formatted);\n        $(listPriceSelector).attr('content', lineItem.price.list.decimalPrice);\n    }\n}\n\n/**\n * Generates the modal window on the first call.\n *\n */\nfunction getModalHtmlElement() {\n    if ($('#editProductModal').length !== 0) {\n        $('#editProductModal').remove();\n    }\n    var htmlString = '<!-- Modal -->'\n        + '<div class=\"modal fade\" id=\"editProductModal\" role=\"dialog\">'\n        + '<div class=\"modal-dialog quick-view-dialog\">'\n        + '<!-- Modal content-->'\n        + '<div class=\"modal-content\">'\n        + '<div class=\"modal-header\">'\n        + '    <button type=\"button\" class=\"close pull-right\" data-dismiss=\"modal\">'\n        + '        &times;'\n        + '    </button>'\n        + '</div>'\n        + '<div class=\"modal-body\"></div>'\n        + '<div class=\"modal-footer\"></div>'\n        + '</div>'\n        + '</div>'\n        + '</div>';\n    $('body').append(htmlString);\n}\n\n/**\n * Parses the html for a modal window\n * @param {string} html - representing the body and footer of the modal window\n *\n * @return {Object} - Object with properties body and footer.\n */\nfunction parseHtml(html) {\n    var $html = $('<div>').append($.parseHTML(html));\n\n    var body = $html.find('.product-quickview');\n    var footer = $html.find('.modal-footer').children();\n\n    return { body: body, footer: footer };\n}\n\n/**\n * replaces the content in the modal window for product variation to be edited.\n * @param {string} editProductUrl - url to be used to retrieve a new product model\n */\nfunction fillModalElement(editProductUrl) {\n    $('.modal-body').spinner().start();\n    $.ajax({\n        url: editProductUrl,\n        method: 'GET',\n        dataType: 'html',\n        success: function (html) {\n            var parsedHtml = parseHtml(html);\n\n            $('#editProductModal .modal-body').empty();\n            $('#editProductModal .modal-body').html(parsedHtml.body);\n            $('#editProductModal .modal-footer').html(parsedHtml.footer);\n            $('#editProductModal').modal('show');\n            $.spinner().stop();\n        },\n        error: function () {\n            $.spinner().stop();\n        }\n    });\n}\n\n/**\n * replace content of modal\n * @param {string} actionUrl - url to be used to remove product\n * @param {string} productID - pid\n * @param {string} productName - product name\n * @param {string} uuid - uuid\n */\nfunction confirmDelete(actionUrl, productID, productName, uuid) {\n    var $deleteConfirmBtn = $('.cart-delete-confirmation-btn');\n    var $productToRemoveSpan = $('.product-to-remove');\n\n    $deleteConfirmBtn.data('pid', productID);\n    $deleteConfirmBtn.data('action', actionUrl);\n    $deleteConfirmBtn.data('uuid', uuid);\n\n    $productToRemoveSpan.empty().append(productName);\n}\n\nmodule.exports = function () {\n    $('body').on('click', '.remove-product', function (e) {\n        e.preventDefault();\n\n        var actionUrl = $(this).data('action');\n        var productID = $(this).data('pid');\n        var productName = $(this).data('name');\n        var uuid = $(this).data('uuid');\n        confirmDelete(actionUrl, productID, productName, uuid);\n    });\n\n    $('body').on('afterRemoveFromCart', function (e, data) {\n        e.preventDefault();\n        confirmDelete(data.actionUrl, data.productID, data.productName, data.uuid);\n    });\n\n    $('.optional-promo').click(function (e) {\n        e.preventDefault();\n        $('.promo-code-form').toggle();\n    });\n\n    $('body').on('click', '.cart-delete-confirmation-btn', function (e) {\n        e.preventDefault();\n\n        var productID = $(this).data('pid');\n        var url = $(this).data('action');\n        var uuid = $(this).data('uuid');\n        var urlParams = {\n            pid: productID,\n            uuid: uuid\n        };\n\n        url = appendToUrl(url, urlParams);\n\n        $('body > .modal-backdrop').remove();\n\n        $.spinner().start();\n        $.ajax({\n            url: url,\n            type: 'get',\n            dataType: 'json',\n            success: function (data) {\n                if (data.basket.items.length === 0) {\n                    $('.cart').empty().append('<div class=\"row\"> ' +\n                        '<div class=\"col-12 text-center\"> ' +\n                        '<h1>' + data.basket.resources.emptyCartMsg + '</h1> ' +\n                        '</div> ' +\n                        '</div>'\n                    );\n                    $('.number-of-items').empty().append(data.basket.resources.numberOfItems);\n                    $('.minicart-quantity').empty().append(data.basket.numItems);\n                    $('.minicart .popover').empty();\n                    $('.minicart .popover').removeClass('show');\n                    $('body').removeClass('modal-open');\n                    $('html').removeClass('veiled');\n                } else {\n                    if (data.toBeDeletedUUIDs && data.toBeDeletedUUIDs.length > 0) {\n                        for (var i = 0; i < data.toBeDeletedUUIDs.length; i++) {\n                            $('.uuid-' + data.toBeDeletedUUIDs[i]).remove();\n                        }\n                    }\n                    $('.uuid-' + uuid).remove();\n                    if (!data.basket.hasBonusProduct) {\n                        $('.bonus-product').remove();\n                    }\n                    $('.coupons-and-promos').empty().append(data.basket.totals.discountsHtml);\n                    updateCartTotals(data.basket);\n                    updateApproachingDiscounts(data.basket.approachingDiscounts);\n                    $('body').trigger('setShippingMethodSelection', data.basket);\n                    validateBasket(data.basket);\n                }\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n\n    $('body').on('change', '.quantity-form > .quantity', function () {\n        var preSelectQty = $(this).data('pre-select-qty');\n        var quantity = $(this).val();\n        var productID = $(this).data('pid');\n        var url = $(this).data('action');\n        var uuid = $(this).data('uuid');\n\n        var urlParams = {\n            pid: productID,\n            quantity: quantity,\n            uuid: uuid\n        };\n        url = appendToUrl(url, urlParams);\n\n        $(this).parents('.card').spinner().start();\n\n        $.ajax({\n            url: url,\n            type: 'get',\n            context: this,\n            dataType: 'json',\n            success: function (data) {\n                $('.quantity[data-uuid=\"' + uuid + '\"]').val(quantity);\n                $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\n                updateCartTotals(data);\n                updateApproachingDiscounts(data.approachingDiscounts);\n                updateAvailability(data, uuid);\n                validateBasket(data);\n                $(this).data('pre-select-qty', quantity);\n                $.spinner().stop();\n                if ($(this).parents('.product-info').hasClass('bonus-product-line-item') && $('.cart-page').length) {\n                    location.reload();\n                }\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $(this).val(parseInt(preSelectQty, 10));\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n\n    $('.shippingMethods').change(function () {\n        var url = $(this).attr('data-actionUrl');\n        var urlParams = {\n            methodID: $(this).find(':selected').attr('data-shipping-id')\n        };\n        // url = appendToUrl(url, urlParams);\n\n        $('.totals').spinner().start();\n        $.ajax({\n            url: url,\n            type: 'post',\n            dataType: 'json',\n            data: urlParams,\n            success: function (data) {\n                if (data.error) {\n                    window.location.href = data.redirectUrl;\n                } else {\n                    $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\n                    updateCartTotals(data);\n                    updateApproachingDiscounts(data.approachingDiscounts);\n                    validateBasket(data);\n                }\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.redirectUrl) {\n                    window.location.href = err.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n\n    $('.promo-code-form').submit(function (e) {\n        e.preventDefault();\n        $.spinner().start();\n        $('.coupon-missing-error').hide();\n        $('.coupon-error-message').empty();\n        if (!$('.coupon-code-field').val()) {\n            $('.promo-code-form .form-control').addClass('is-invalid');\n            $('.coupon-missing-error').show();\n            $.spinner().stop();\n            return false;\n        }\n        var $form = $('.promo-code-form');\n        $('.promo-code-form .form-control').removeClass('is-invalid');\n        $('.coupon-error-message').empty();\n\n        $.ajax({\n            url: $form.attr('action'),\n            type: 'GET',\n            dataType: 'json',\n            data: $form.serialize(),\n            success: function (data) {\n                if (data.error) {\n                    $('.promo-code-form .form-control').addClass('is-invalid');\n                    $('.coupon-error-message').empty().append(data.errorMessage);\n                } else {\n                    $('.coupons-and-promos').empty().append(data.totals.discountsHtml);\n                    updateCartTotals(data);\n                    updateApproachingDiscounts(data.approachingDiscounts);\n                    validateBasket(data);\n                }\n                $('.coupon-code-field').val('');\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n        return false;\n    });\n\n    $('body').on('click', '.remove-coupon', function (e) {\n        e.preventDefault();\n\n        var couponCode = $(this).data('code');\n        var uuid = $(this).data('uuid');\n        var $deleteConfirmBtn = $('.delete-coupon-confirmation-btn');\n        var $productToRemoveSpan = $('.coupon-to-remove');\n\n        $deleteConfirmBtn.data('uuid', uuid);\n        $deleteConfirmBtn.data('code', couponCode);\n\n        $productToRemoveSpan.empty().append(couponCode);\n    });\n\n    $('body').on('click', '.delete-coupon-confirmation-btn', function (e) {\n        e.preventDefault();\n\n        var url = $(this).data('action');\n        var uuid = $(this).data('uuid');\n        var couponCode = $(this).data('code');\n        var urlParams = {\n            code: couponCode,\n            uuid: uuid\n        };\n\n        url = appendToUrl(url, urlParams);\n\n        $('body > .modal-backdrop').remove();\n\n        $.spinner().start();\n        $.ajax({\n            url: url,\n            type: 'get',\n            dataType: 'json',\n            success: function (data) {\n                $('.coupon-uuid-' + uuid).remove();\n                updateCartTotals(data);\n                updateApproachingDiscounts(data.approachingDiscounts);\n                validateBasket(data);\n                $.spinner().stop();\n            },\n            error: function (err) {\n                if (err.responseJSON.redirectUrl) {\n                    window.location.href = err.responseJSON.redirectUrl;\n                } else {\n                    createErrorNotification(err.responseJSON.errorMessage);\n                    $.spinner().stop();\n                }\n            }\n        });\n    });\n    $('body').on('click', '.cart-page .bonus-product-button', function () {\n        $.spinner().start();\n        $.ajax({\n            url: $(this).data('url'),\n            method: 'GET',\n            dataType: 'json',\n            success: function (data) {\n                base.methods.editBonusProducts(data);\n                $.spinner().stop();\n            },\n            error: function () {\n                $.spinner().stop();\n            }\n        });\n    });\n    $('body').on('click', '.cart-page .product-edit .edit, .cart-page .bundle-edit .edit', function (e) {\n        e.preventDefault();\n\n        var editProductUrl = $(this).attr('href');\n        getModalHtmlElement();\n        fillModalElement(editProductUrl);\n    });\n\n    $('body').on('product:updateAddToCart', function (e, response) {\n        // update global add to cart (single products, bundles)\n        var dialog = $(response.$productContainer)\n            .closest('.quick-view-dialog');\n\n        $('.update-cart-product-global', dialog).attr('disabled',\n            !$('.global-availability', dialog).data('ready-to-order')\n            || !$('.global-availability', dialog).data('available')\n        );\n    });\n\n    $('body').on('product:updateAvailability', function (e, response) {\n        // bundle individual products\n        $('.product-availability', response.$productContainer)\n            .data('ready-to-order', response.product.readyToOrder)\n            .data('available', response.product.available)\n            .find('.availability-msg')\n            .empty()\n            .html(response.message);\n\n\n        var dialog = $(response.$productContainer)\n            .closest('.quick-view-dialog');\n\n        if ($('.product-availability', dialog).length) {\n            // bundle all products\n            var allAvailable = $('.product-availability', dialog).toArray()\n                .every(function (item) { return $(item).data('available'); });\n\n            var allReady = $('.product-availability', dialog).toArray()\n                .every(function (item) { return $(item).data('ready-to-order'); });\n\n            $('.global-availability', dialog)\n                .data('ready-to-order', allReady)\n                .data('available', allAvailable);\n\n            $('.global-availability .availability-msg', dialog).empty()\n                .html(allReady ? response.message : response.resources.info_selectforstock);\n        } else {\n            // single product\n            $('.global-availability', dialog)\n                .data('ready-to-order', response.product.readyToOrder)\n                .data('available', response.product.available)\n                .find('.availability-msg')\n                .empty()\n                .html(response.message);\n        }\n    });\n\n    $('body').on('product:afterAttributeSelect', function (e, response) {\n        if ($('.modal.show .product-quickview .bundle-items').length) {\n            $('.modal.show').find(response.container).data('pid', response.data.product.id);\n            $('.modal.show').find(response.container).find('.product-id').text(response.data.product.id);\n        } else {\n            $('.modal.show .product-quickview').data('pid', response.data.product.id);\n        }\n    });\n\n    $('body').on('change', '.quantity-select', function () {\n        var selectedQuantity = $(this).val();\n        $('.modal.show .update-cart-url').data('selected-quantity', selectedQuantity);\n    });\n\n    $('body').on('click', '.update-cart-product-global', function (e) {\n        e.preventDefault();\n\n        var updateProductUrl = $(this).closest('.cart-and-ipay').find('.update-cart-url').val();\n        var selectedQuantity = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('selected-quantity');\n        var uuid = $(this).closest('.cart-and-ipay').find('.update-cart-url').data('uuid');\n\n        var form = {\n            uuid: uuid,\n            pid: base.getPidValue($(this)),\n            quantity: selectedQuantity\n        };\n\n        $(this).parents('.card').spinner().start();\n        if (updateProductUrl) {\n            $.ajax({\n                url: updateProductUrl,\n                type: 'post',\n                context: this,\n                data: form,\n                dataType: 'json',\n                success: function (data) {\n                    $('#editProductModal').remove();\n                    $('.modal-backdrop').remove();\n                    $('body').removeClass('modal-open');\n\n                    $('.coupons-and-promos').empty().append(data.cartModel.totals.discountsHtml);\n                    updateCartTotals(data.cartModel);\n                    updateApproachingDiscounts(data.cartModel.approachingDiscounts);\n                    updateAvailability(data.cartModel, uuid);\n                    updateProductDetails(data, uuid);\n\n                    if (data.uuidToBeDeleted) {\n                        $('.uuid-' + data.uuidToBeDeleted).remove();\n                    }\n\n                    validateBasket(data.cartModel);\n\n                    $.spinner().stop();\n                },\n                error: function (err) {\n                    if (err.responseJSON.redirectUrl) {\n                        window.location.href = err.responseJSON.redirectUrl;\n                    } else {\n                        createErrorNotification(err.responseJSON.errorMessage);\n                        $.spinner().stop();\n                    }\n                }\n            });\n        }\n    });\n\n\n    base.selectAttribute();\n    base.colorAttribute();\n    base.removeBonusProduct();\n    base.selectBonusProduct();\n    base.enableBonusProductSelection();\n    base.showMoreBonusProducts();\n    base.addBonusProductsToCart();\n};\n","'use strict';\n\n/**\n * Retrieves the relevant pid value\n * @param {jquery} $el - DOM container for a given add to cart button\n * @return {string} - value to be used when adding product to cart\n */\nfunction getPidValue($el) {\n    var pid;\n\n    if ($('#quickViewModal').hasClass('show') && !$('.product-set').length) {\n        pid = $($el).closest('.modal-content').find('.product-quickview').data('pid');\n    } else if ($('.product-set-detail').length || $('.product-set').length) {\n        pid = $($el).closest('.product-detail').find('.product-id').text();\n    } else {\n        pid = $('.product-detail:not(\".bundle-item\")').data('pid');\n    }\n\n    return pid;\n}\n\n/**\n * Retrieve contextual quantity selector\n * @param {jquery} $el - DOM container for the relevant quantity\n * @return {jquery} - quantity selector DOM container\n */\nfunction getQuantitySelector($el) {\n    return $el && $('.set-items').length\n        ? $($el).closest('.product-detail').find('.quantity-select')\n        : $('.quantity-select');\n}\n\n/**\n * Retrieves the value associated with the Quantity pull-down menu\n * @param {jquery} $el - DOM container for the relevant quantity\n * @return {string} - value found in the quantity input\n */\nfunction getQuantitySelected($el) {\n    return getQuantitySelector($el).val();\n}\n\n/**\n * Process the attribute values for an attribute that has image swatches\n *\n * @param {Object} attr - Attribute\n * @param {string} attr.id - Attribute ID\n * @param {Object[]} attr.values - Array of attribute value objects\n * @param {string} attr.values.value - Attribute coded value\n * @param {string} attr.values.url - URL to de/select an attribute value of the product\n * @param {boolean} attr.values.isSelectable - Flag as to whether an attribute value can be\n *     selected.  If there is no variant that corresponds to a specific combination of attribute\n *     values, an attribute may be disabled in the Product Detail Page\n * @param {jQuery} $productContainer - DOM container for a given product\n */\nfunction processSwatchValues(attr, $productContainer) {\n    attr.values.forEach(function (attrValue) {\n        var $attrValue = $productContainer.find('[data-attr=\"' + attr.id + '\"] [data-attr-value=\"' +\n            attrValue.value + '\"]');\n        var $swatchAnchor = $attrValue.parent();\n\n        if (attrValue.selected) {\n            $attrValue.addClass('selected');\n        } else {\n            $attrValue.removeClass('selected');\n        }\n\n        if (attrValue.url) {\n            $swatchAnchor.attr('href', attrValue.url);\n        } else {\n            $swatchAnchor.removeAttr('href');\n        }\n\n        // Disable if not selectable\n        $attrValue.removeClass('selectable unselectable');\n\n        $attrValue.addClass(attrValue.selectable ? 'selectable' : 'unselectable');\n    });\n}\n\n/**\n * Process attribute values associated with an attribute that does not have image swatches\n *\n * @param {Object} attr - Attribute\n * @param {string} attr.id - Attribute ID\n * @param {Object[]} attr.values - Array of attribute value objects\n * @param {string} attr.values.value - Attribute coded value\n * @param {string} attr.values.url - URL to de/select an attribute value of the product\n * @param {boolean} attr.values.isSelectable - Flag as to whether an attribute value can be\n *     selected.  If there is no variant that corresponds to a specific combination of attribute\n *     values, an attribute may be disabled in the Product Detail Page\n * @param {jQuery} $productContainer - DOM container for a given product\n */\nfunction processNonSwatchValues(attr, $productContainer) {\n    var $attr = '[data-attr=\"' + attr.id + '\"]';\n    var $defaultOption = $productContainer.find($attr + ' .select-' + attr.id + ' option:first');\n    $defaultOption.attr('value', attr.resetUrl);\n\n    attr.values.forEach(function (attrValue) {\n        var $attrValue = $productContainer\n            .find($attr + ' [data-attr-value=\"' + attrValue.value + '\"]');\n        $attrValue.attr('value', attrValue.url)\n            .removeAttr('disabled');\n\n        if (!attrValue.selectable) {\n            $attrValue.attr('disabled', true);\n        }\n    });\n}\n\n/**\n * Routes the handling of attribute processing depending on whether the attribute has image\n *     swatches or not\n *\n * @param {Object} attrs - Attribute\n * @param {string} attr.id - Attribute ID\n * @param {jQuery} $productContainer - DOM element for a given product\n */\nfunction updateAttrs(attrs, $productContainer) {\n    // Currently, the only attribute type that has image swatches is Color.\n    var attrsWithSwatches = ['color'];\n\n    attrs.forEach(function (attr) {\n        if (attrsWithSwatches.indexOf(attr.id) > -1) {\n            processSwatchValues(attr, $productContainer);\n        } else {\n            processNonSwatchValues(attr, $productContainer);\n        }\n    });\n}\n\n/**\n * Updates the availability status in the Product Detail Page\n *\n * @param {Object} response - Ajax response object after an\n *                            attribute value has been [de]selected\n * @param {jQuery} $productContainer - DOM element for a given product\n */\nfunction updateAvailability(response, $productContainer) {\n    var availabilityValue = '';\n    var availabilityMessages = response.product.availability.messages;\n    if (!response.product.readyToOrder) {\n        availabilityValue = '<div>' + response.resources.info_selectforstock + '</div>';\n    } else {\n        availabilityMessages.forEach(function (message) {\n            availabilityValue += '<div>' + message + '</div>';\n        });\n    }\n\n    $($productContainer).trigger('product:updateAvailability', {\n        product: response.product,\n        $productContainer: $productContainer,\n        message: availabilityValue,\n        resources: response.resources\n    });\n}\n\n/**\n * Generates html for promotions section\n *\n * @param {array} promotions - list of promotions\n * @return {string} - Compiled HTML\n */\nfunction getPromotionsHtml(promotions) {\n    if (!promotions) {\n        return '';\n    }\n\n    var html = '';\n\n    promotions.forEach(function (promotion) {\n        html += '<div class=\"callout\" title=\"' + promotion.details + '\">' + promotion.calloutMsg +\n            '</div>';\n    });\n\n    return html;\n}\n\n/**\n * Generates html for product attributes section\n *\n * @param {array} attributes - list of attributes\n * @return {string} - Compiled HTML\n */\nfunction getAttributesHtml(attributes) {\n    if (!attributes) {\n        return '';\n    }\n\n    var html = '';\n\n    attributes.forEach(function (attributeGroup) {\n        if (attributeGroup.ID === 'mainAttributes') {\n            attributeGroup.attributes.forEach(function (attribute) {\n                html += '<div class=\"attribute-values\">' + attribute.label + ': '\n                    + attribute.value + '</div>';\n            });\n        }\n    });\n\n    return html;\n}\n\n/**\n * @typedef UpdatedOptionValue\n * @type Object\n * @property {string} id - Option value ID for look up\n * @property {string} url - Updated option value selection URL\n */\n\n/**\n * @typedef OptionSelectionResponse\n * @type Object\n * @property {string} priceHtml - Updated price HTML code\n * @property {Object} options - Updated Options\n * @property {string} options.id - Option ID\n * @property {UpdatedOptionValue[]} options.values - Option values\n */\n\n/**\n * Updates DOM using post-option selection Ajax response\n *\n * @param {OptionSelectionResponse} options - Ajax response options from selecting a product option\n * @param {jQuery} $productContainer - DOM element for current product\n */\nfunction updateOptions(options, $productContainer) {\n    options.forEach(function (option) {\n        var $optionEl = $productContainer.find('.product-option[data-option-id*=\"' + option.id\n            + '\"]');\n        option.values.forEach(function (value) {\n            var valueEl = $optionEl.find('option[data-value-id*=\"' + value.id + '\"]');\n            valueEl.val(value.url);\n        });\n    });\n}\n\n/**\n * Parses JSON from Ajax call made whenever an attribute value is [de]selected\n * @param {Object} response - response from Ajax call\n * @param {Object} response.product - Product object\n * @param {string} response.product.id - Product ID\n * @param {Object[]} response.product.variationAttributes - Product attributes\n * @param {Object[]} response.product.images - Product images\n * @param {boolean} response.product.hasRequiredAttrsSelected - Flag as to whether all required\n *     attributes have been selected.  Used partially to\n *     determine whether the Add to Cart button can be enabled\n * @param {jQuery} $productContainer - DOM element for a given product.\n */\nfunction handleVariantResponse(response, $productContainer) {\n    var isChoiceOfBonusProducts =\n        $productContainer.parents('.choose-bonus-product-dialog').length > 0;\n    var isVaraint;\n    if (response.product.variationAttributes) {\n        updateAttrs(response.product.variationAttributes, $productContainer);\n        isVaraint = response.product.productType === 'variant';\n        if (isChoiceOfBonusProducts && isVaraint) {\n            $productContainer.parent('.bonus-product-item')\n                .data('pid', response.product.id);\n\n            $productContainer.parent('.bonus-product-item')\n                .data('ready-to-order', response.product.readyToOrder);\n        }\n    }\n\n    // Update primary images\n    var primaryImageUrls = response.product.images;\n    primaryImageUrls.large.forEach(function (imageUrl, idx) {\n        $productContainer.find('.primary-images').find('img').eq(idx)\n            .attr('src', imageUrl.url);\n    });\n\n    // Update pricing\n    if (!isChoiceOfBonusProducts) {\n        var $priceSelector = $('.prices .price', $productContainer).length\n            ? $('.prices .price', $productContainer)\n            : $('.prices .price');\n        $priceSelector.replaceWith(response.product.price.html);\n    }\n\n    // Update promotions\n    $('.promotions').empty().html(getPromotionsHtml(response.product.promotions));\n\n    updateAvailability(response, $productContainer);\n\n    if (isChoiceOfBonusProducts) {\n        var $selectButton = $productContainer.find('.select-bonus-product');\n        $selectButton.trigger('bonusproduct:updateSelectButton', {\n            product: response.product, $productContainer: $productContainer\n        });\n    } else {\n        // Enable \"Add to Cart\" button if all required attributes have been selected\n        $('button.add-to-cart, button.add-to-cart-global, button.update-cart-product-global').trigger('product:updateAddToCart', {\n            product: response.product, $productContainer: $productContainer\n        }).trigger('product:statusUpdate', response.product);\n    }\n\n    // Update attributes\n    $productContainer.find('.main-attributes').empty()\n        .html(getAttributesHtml(response.product.attributes));\n}\n\n/**\n * @typespec UpdatedQuantity\n * @type Object\n * @property {boolean} selected - Whether the quantity has been selected\n * @property {string} value - The number of products to purchase\n * @property {string} url - Compiled URL that specifies variation attributes, product ID, options,\n *     etc.\n */\n\n/**\n * Updates the quantity DOM elements post Ajax call\n * @param {UpdatedQuantity[]} quantities -\n * @param {jQuery} $productContainer - DOM container for a given product\n */\nfunction updateQuantities(quantities, $productContainer) {\n    if (!($productContainer.parent('.bonus-product-item').length > 0)) {\n        var optionsHtml = quantities.map(function (quantity) {\n            var selected = quantity.selected ? ' selected ' : '';\n            return '<option value=\"' + quantity.value + '\"  data-url=\"' + quantity.url + '\"' +\n                selected + '>' + quantity.value + '</option>';\n        }).join('');\n        getQuantitySelector($productContainer).empty().html(optionsHtml);\n    }\n}\n\n/**\n * updates the product view when a product attribute is selected or deselected or when\n *         changing quantity\n * @param {string} selectedValueUrl - the Url for the selected variation value\n * @param {jQuery} $productContainer - DOM element for current product\n */\nfunction attributeSelect(selectedValueUrl, $productContainer) {\n    if (selectedValueUrl) {\n        $('body').trigger('product:beforeAttributeSelect',\n            { url: selectedValueUrl, container: $productContainer });\n\n        $.ajax({\n            url: selectedValueUrl,\n            method: 'GET',\n            success: function (data) {\n                handleVariantResponse(data, $productContainer);\n                updateOptions(data.product.options, $productContainer);\n                updateQuantities(data.product.quantities, $productContainer);\n                $('body').trigger('product:afterAttributeSelect',\n                    { data: data, container: $productContainer });\n                $.spinner().stop();\n            },\n            error: function () {\n                $.spinner().stop();\n            }\n        });\n    }\n}\n\n/**\n * Retrieves url to use when adding a product to the cart\n *\n * @return {string} - The provided URL to use when adding a product to the cart\n */\nfunction getAddToCartUrl() {\n    return $('.add-to-cart-url').val();\n}\n\n/**\n * Parses the html for a modal window\n * @param {string} html - representing the body and footer of the modal window\n *\n * @return {Object} - Object with properties body and footer.\n */\nfunction parseHtml(html) {\n    var $html = $('<div>').append($.parseHTML(html));\n\n    var body = $html.find('.choice-of-bonus-product');\n    var footer = $html.find('.modal-footer').children();\n\n    return { body: body, footer: footer };\n}\n\n/**\n * Retrieves url to use when adding a product to the cart\n *\n * @param {Object} data - data object used to fill in dynamic portions of the html\n */\nfunction chooseBonusProducts(data) {\n    $('.modal-body').spinner().start();\n\n    if ($('#chooseBonusProductModal').length !== 0) {\n        $('#chooseBonusProductModal').remove();\n    }\n    var bonusUrl;\n    if (data.bonusChoiceRuleBased) {\n        bonusUrl = data.showProductsUrlRuleBased;\n    } else {\n        bonusUrl = data.showProductsUrlListBased;\n    }\n\n    var htmlString = '<!-- Modal -->'\n        + '<div class=\"modal fade\" id=\"chooseBonusProductModal\" role=\"dialog\">'\n        + '<div class=\"modal-dialog choose-bonus-product-dialog\" '\n        + 'data-total-qty=\"' + data.maxBonusItems + '\"'\n        + 'data-UUID=\"' + data.uuid + '\"'\n        + 'data-pliUUID=\"' + data.pliUUID + '\"'\n        + 'data-addToCartUrl=\"' + data.addToCartUrl + '\"'\n        + 'data-pageStart=\"0\"'\n        + 'data-pageSize=\"' + data.pageSize + '\"'\n        + 'data-moreURL=\"' + data.showProductsUrlRuleBased + '\"'\n        + 'data-bonusChoiceRuleBased=\"' + data.bonusChoiceRuleBased + '\">'\n        + '<!-- Modal content-->'\n        + '<div class=\"modal-content\">'\n        + '<div class=\"modal-header\">'\n        + '    <span class=\"\">' + data.labels.selectprods + '</span>'\n        + '    <button type=\"button\" class=\"close pull-right\" data-dismiss=\"modal\">&times;</button>'\n        + '</div>'\n        + '<div class=\"modal-body\"></div>'\n        + '<div class=\"modal-footer\"></div>'\n        + '</div>'\n        + '</div>'\n        + '</div>';\n    $('body').append(htmlString);\n    $('.modal-body').spinner().start();\n\n    $.ajax({\n        url: bonusUrl,\n        method: 'GET',\n        dataType: 'html',\n        success: function (html) {\n            var parsedHtml = parseHtml(html);\n            $('#chooseBonusProductModal .modal-body').empty();\n            $('#chooseBonusProductModal .modal-body').html(parsedHtml.body);\n            $('#chooseBonusProductModal .modal-footer').html(parsedHtml.footer);\n            $('#chooseBonusProductModal').modal('show');\n            $.spinner().stop();\n        },\n        error: function () {\n            $.spinner().stop();\n        }\n    });\n}\n\n/**\n * Updates the Mini-Cart quantity value after the customer has pressed the \"Add to Cart\" button\n * @param {string} response - ajax response from clicking the add to cart button\n */\nfunction handlePostCartAdd(response) {\n    $('.minicart').trigger('count:update', response);\n    var messageType = response.error ? 'alert-danger' : 'alert-success';\n    // show add to cart toast\n    if (response.newBonusDiscountLineItem\n        && Object.keys(response.newBonusDiscountLineItem).length !== 0) {\n        chooseBonusProducts(response.newBonusDiscountLineItem);\n    } else {\n        if ($('.add-to-cart-messages').length === 0) {\n            $('body').append(\n            '<div class=\"add-to-cart-messages\"></div>'\n            );\n        }\n\n        $('.add-to-cart-messages').append(\n            '<div class=\"alert ' + messageType + ' add-to-basket-alert text-center\" role=\"alert\">'\n            + response.message\n            + '</div>'\n        );\n\n        setTimeout(function () {\n            $('.add-to-basket-alert').remove();\n        }, 5000);\n    }\n}\n\n/**\n * Retrieves the bundle product item ID's for the Controller to replace bundle master product\n * items with their selected variants\n *\n * @return {string[]} - List of selected bundle product item ID's\n */\nfunction getChildProducts() {\n    var childProducts = [];\n    $('.bundle-item').each(function () {\n        childProducts.push({\n            pid: $(this).find('.product-id').text(),\n            quantity: parseInt($(this).find('label.quantity').data('quantity'), 10)\n        });\n    });\n\n    return childProducts.length ? JSON.stringify(childProducts) : [];\n}\n\n/**\n * Retrieve product options\n *\n * @param {jQuery} $productContainer - DOM element for current product\n * @return {string} - Product options and their selected values\n */\nfunction getOptions($productContainer) {\n    var options = $productContainer\n        .find('.product-option')\n        .map(function () {\n            var $elOption = $(this).find('.options-select');\n            var urlValue = $elOption.val();\n            var selectedValueId = $elOption.find('option[value=\"' + urlValue + '\"]')\n                .data('value-id');\n            return {\n                optionId: $(this).data('option-id'),\n                selectedValueId: selectedValueId\n            };\n        }).toArray();\n\n    return JSON.stringify(options);\n}\n\nmodule.exports = {\n    attributeSelect: attributeSelect,\n    methods: {\n        editBonusProducts: function (data) {\n            chooseBonusProducts(data);\n        }\n    },\n    colorAttribute: function () {\n        $(document).on('click', '[data-attr=\"color\"] a', function (e) {\n            e.preventDefault();\n\n            if ($(this).attr('disabled')) {\n                return;\n            }\n            var $productContainer = $(this).closest('.set-item');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.product-detail');\n            }\n\n            attributeSelect(e.currentTarget.href, $productContainer);\n        });\n    },\n\n    selectAttribute: function () {\n        $(document).on('change', 'select[class*=\"select-\"], .options-select', function (e) {\n            e.preventDefault();\n\n            var $productContainer = $(this).closest('.set-item');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.product-detail');\n            }\n            attributeSelect(e.currentTarget.value, $productContainer);\n        });\n    },\n\n    availability: function () {\n        $(document).on('change', '.quantity-select', function (e) {\n            e.preventDefault();\n\n            var $productContainer = $(this).closest('.product-detail');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.modal-content').find('.product-quickview');\n            }\n\n            if ($('.bundle-items', $productContainer).length === 0) {\n                attributeSelect($(e.currentTarget).find('option:selected').data('url'),\n                    $productContainer);\n            }\n        });\n    },\n\n    addToCart: function () {\n        $(document).on('click', 'button.add-to-cart, button.add-to-cart-global', function () {\n            var addToCartUrl;\n            var pid;\n            var pidsObj;\n            var setPids;\n\n            $('body').trigger('product:beforeAddToCart', this);\n\n            if ($('.set-items').length && $(this).hasClass('add-to-cart-global')) {\n                setPids = [];\n\n                $('.product-detail').each(function () {\n                    if (!$(this).hasClass('product-set-detail')) {\n                        setPids.push({\n                            pid: $(this).find('.product-id').text(),\n                            qty: $(this).find('.quantity-select').val(),\n                            options: getOptions($(this))\n                        });\n                    }\n                });\n                pidsObj = JSON.stringify(setPids);\n            }\n\n            pid = getPidValue($(this));\n\n            var $productContainer = $(this).closest('.product-detail');\n            if (!$productContainer.length) {\n                $productContainer = $(this).closest('.quick-view-dialog').find('.product-detail');\n            }\n\n            addToCartUrl = getAddToCartUrl();\n\n            var form = {\n                pid: pid,\n                pidsObj: pidsObj,\n                childProducts: getChildProducts(),\n                quantity: getQuantitySelected($(this))\n            };\n\n            if (!$('.bundle-item').length) {\n                form.options = getOptions($productContainer);\n            }\n\n            $(this).trigger('updateAddToCartFormData', form);\n            if (addToCartUrl) {\n                $.ajax({\n                    url: addToCartUrl,\n                    method: 'POST',\n                    data: form,\n                    success: function (data) {\n                        handlePostCartAdd(data);\n                        $('body').trigger('product:afterAddToCart', data);\n                        $.spinner().stop();\n                    },\n                    error: function () {\n                        $.spinner().stop();\n                    }\n                });\n            }\n        });\n    },\n    selectBonusProduct: function () {\n        $(document).on('click', '.select-bonus-product', function () {\n            var $choiceOfBonusProduct = $(this).parents('.choice-of-bonus-product');\n            var pid = $(this).data('pid');\n            var maxPids = $('.choose-bonus-product-dialog').data('total-qty');\n            var submittedQty = parseInt($(this).parents('.choice-of-bonus-product').find('.bonus-quantity-select').val(), 10);\n            var totalQty = 0;\n            $.each($('#chooseBonusProductModal .selected-bonus-products .selected-pid'), function () {\n                totalQty += $(this).data('qty');\n            });\n            totalQty += submittedQty;\n            var optionID = $(this).parents('.choice-of-bonus-product').find('.product-option').data('option-id');\n            var valueId = $(this).parents('.choice-of-bonus-product').find('.options-select option:selected').data('valueId');\n            if (totalQty <= maxPids) {\n                var selectedBonusProductHtml = ''\n                + '<div class=\"selected-pid row\" '\n                + 'data-pid=\"' + pid + '\"'\n                + 'data-qty=\"' + submittedQty + '\"'\n                + 'data-optionID=\"' + (optionID || '') + '\"'\n                + 'data-option-selected-value=\"' + (valueId || '') + '\"'\n                + '>'\n                + '<div class=\"col-sm-11 col-9 bonus-product-name\" >'\n                + $choiceOfBonusProduct.find('.product-name').html()\n                + '</div>'\n                + '<div class=\"col-1\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></div>'\n                + '</div>'\n                ;\n                $('#chooseBonusProductModal .selected-bonus-products').append(selectedBonusProductHtml);\n                $('.pre-cart-products').html(totalQty);\n                $('.selected-bonus-products .bonus-summary').removeClass('alert-danger');\n            } else {\n                $('.selected-bonus-products .bonus-summary').addClass('alert-danger');\n            }\n        });\n    },\n    removeBonusProduct: function () {\n        $(document).on('click', '.selected-pid', function () {\n            $(this).remove();\n            var $selected = $('#chooseBonusProductModal .selected-bonus-products .selected-pid');\n            var count = 0;\n            if ($selected.length) {\n                $selected.each(function () {\n                    count += parseInt($(this).data('qty'), 10);\n                });\n            }\n\n            $('.pre-cart-products').html(count);\n            $('.selected-bonus-products .bonus-summary').removeClass('alert-danger');\n        });\n    },\n    enableBonusProductSelection: function () {\n        $('body').on('bonusproduct:updateSelectButton', function (e, response) {\n            $('button.select-bonus-product', response.$productContainer).attr('disabled',\n                (!response.product.readyToOrder || !response.product.available));\n            var pid = response.product.id;\n            $('button.select-bonus-product').data('pid', pid);\n        });\n    },\n    showMoreBonusProducts: function () {\n        $(document).on('click', '.show-more-bonus-products', function () {\n            var url = $(this).data('url');\n            $('.modal-content').spinner().start();\n            $.ajax({\n                url: url,\n                method: 'GET',\n                success: function (html) {\n                    var parsedHtml = parseHtml(html);\n                    $('.modal-body').append(parsedHtml.body);\n                    $('.show-more-bonus-products:first').remove();\n                    $('.modal-content').spinner().stop();\n                },\n                error: function () {\n                    $('.modal-content').spinner().stop();\n                }\n            });\n        });\n    },\n    addBonusProductsToCart: function () {\n        $(document).on('click', '.add-bonus-products', function () {\n            var $readyToOrderBonusProducts = $('.choose-bonus-product-dialog .selected-pid');\n            var queryString = '?pids=';\n            var url = $('.choose-bonus-product-dialog').data('addtocarturl');\n            var pidsObject = {\n                bonusProducts: []\n            };\n\n            $.each($readyToOrderBonusProducts, function () {\n                var qtyOption =\n                    parseInt($(this)\n                        .data('qty'), 10);\n\n                var option = null;\n                if (qtyOption > 0) {\n                    if ($(this).data('optionid') && $(this).data('option-selected-value')) {\n                        option = {};\n                        option.optionId = $(this).data('optionid');\n                        option.productId = $(this).data('pid');\n                        option.selectedValueId = $(this).data('option-selected-value');\n                    }\n                    pidsObject.bonusProducts.push({\n                        pid: $(this).data('pid'),\n                        qty: qtyOption,\n                        options: [option]\n                    });\n                    pidsObject.totalQty = parseInt($('.pre-cart-products').html(), 10);\n                }\n            });\n            queryString += JSON.stringify(pidsObject);\n            queryString = queryString + '&uuid=' + $('.choose-bonus-product-dialog').data('uuid');\n            queryString = queryString + '&pliuuid=' + $('.choose-bonus-product-dialog').data('pliuuid');\n            $.spinner().start();\n            $.ajax({\n                url: url + queryString,\n                method: 'POST',\n                success: function (data) {\n                    $.spinner().stop();\n                    if (data.error) {\n                        $('.error-choice-of-bonus-products')\n                        .html(data.errorMessage);\n                    } else {\n                        $('.configure-bonus-product-attributes').html(data);\n                        $('.bonus-products-step2').removeClass('hidden-xl-down');\n                        $('#chooseBonusProductModal').modal('hide');\n\n                        if ($('.add-to-cart-messages').length === 0) {\n                            $('body').append(\n                            '<div class=\"add-to-cart-messages\"></div>'\n                         );\n                        }\n                        $('.minicart-quantity').html(data.totalQty);\n                        $('.add-to-cart-messages').append(\n                            '<div class=\"alert alert-success add-to-basket-alert text-center\"'\n                            + ' role=\"alert\">'\n                            + data.msgSuccess + '</div>'\n                        );\n                        setTimeout(function () {\n                            $('.add-to-basket-alert').remove();\n                            if ($('.cart-page').length) {\n                                location.reload();\n                            }\n                        }, 3000);\n                    }\n                },\n                error: function () {\n                    $.spinner().stop();\n                }\n            });\n        });\n    },\n\n    getPidValue: getPidValue\n};\n","'use strict';\n\nmodule.exports = function (include) {\n    if (typeof include === 'function') {\n        include();\n    } else if (typeof include === 'object') {\n        Object.keys(include).forEach(function (key) {\n            if (typeof include[key] === 'function') {\n                include[key]();\n            }\n        });\n    }\n};\n"],"sourceRoot":""}